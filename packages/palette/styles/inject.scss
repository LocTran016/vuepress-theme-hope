@use 'sass:color';
@use 'sass:list';
@use 'sass:map';
@use 'sass:meta';
@use 'helper';

@use '../palette';
@use '@mr-hope/vuepress-palette';

@mixin inject-value($module) {
  $variables: meta.module-variables($module);

  @each $varName, $varValue in $variables {
    // length
    @if meta.type-of($varValue) == length {
      --#{$varName}: #{$varValue};
    } @else if meta.type-of($varValue) == map {
      // it's a valid color config
      @if meta.type-of(map.get($varValue, "amount")) ==
        list and
        meta.type-of(map.get($varValue, "color")) ==
        list
      {
        @each $amount in map.get($varValue, "amount") {
          :root {
            --#{$varName}-#{if($amount > 0,"l","d")}#{$amount / 1%}: #{color.scale(
                helper.get-color(map.get($varValue, "color"), false),
                $lightness: $amount
              )};
          }

          body[dark] {
            --#{$varName}-#{if($amount > 0,"l","d")}#{$amount / 1%}: #{color.scale(
                helper.get-color(map.get($varValue, "color"), true),
                $lightness: $amount
              )};
          }
        }
      }
    } @else if meta.type-of($varValue) == list and list.length($varValue) == 2 {
      :root {
        --#{$varName}: #{helper.get-color($varValue, false)};
      }

      body[dark] {
        --#{$varName}: #{helper.get-color($varValue, true)};
      }
    }
  }
}
